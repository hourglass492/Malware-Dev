/**
    This is the exe that I will be able to use to call
    my dll
    **/

#include <windows.h>
#include <stdio.h> 
#include <stdlib.h>
#include <string.h>


//Storing the payload as a global changes where it is stored
// in the executable into the data section


int main(void) {

    printf("here I come");

    getchar();

    unsigned char payload[] = {
        0x90,
        0x90,
        0xcc,
        0xc3
    };

    unsigned int payload_len = 4;




    void * payload_mem;
    BOOL succseful_mem_change;
    HANDLE thread;
    DWORD oldprotect = 0;




    //Create a memory area we can controle the permisions of
    payload_mem = VirtualAlloc(0, payload_len, MEM_COMMIT | 
        MEM_RESERVE, PAGE_READWRITE);

    //not sure why I typed: succseful_mem_change
    
    //copy the payload to the memory
    RtlMoveMemory(payload_mem, payload, payload_len);
    
    printf("%-20s : 0x%-016p\n", "payload addr", (void *)payload);
    printf("%-20s : 0x%-016p\n", "payload mem addr", (void *)payload_mem);


    //Change the memory to read exicutable in order to run the payload
    succseful_mem_change = VirtualProtect(payload_mem, payload_len, 
        PAGE_EXECUTE_READ, &oldprotect);

    printf("\n ready to rock and roll\n");


    if ( succseful_mem_change ) {
        thread = CreateThread(0, 0, (LPTHREAD_START_ROUTINE) payload_mem, 0, 0, 0);
        WaitForSingleObject(thread, -1); 
    }


    printf("payload done");



    return 0;

}